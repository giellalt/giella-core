## Process this file with automake to produce Makefile.in
## Copyright: SÃ¡mediggi/Divvun/UiT
## Licence: GPL v3+

# Included by several *.am files. Process the including files with automake.

# This include file contains build targets shared among all speller tools

# Variables:
DATE = $(shell date +%Y%m%d)
TESTTIME = $(shell date +%H%M)
SCRIPTDIR=$(GTCORE)/scripts
LEXICONVERSION=$(shell readlink $(GTLANG2)-latest | tr -d '/')

# Forrest publishing:
SPLTESTREPDIR   = $(GTBIG)/techdoc/proof/spelling/testing

# if Forrest, then
if CAN_FORREST
FORRESTTESTRESULT=$(SPLTESTREPDIR)/$(GTLANG)/$(TESTTOOL)/goldstandard/$(DATE)-$(TESTTIME)-$(SPELLERTESTRESULT)

noinst_DATA+=$(FORRESTTESTRESULT)
endif # CAN_FORREST

# Generate speller input:
$(SPELLERINPUT): $(GSDATA)
	cut -f1 $< > $@

# Convert the speller output to an xml format:
$(SPELLERTESTRESULT): \
		$(GSDATA) \
		$(SPELLEROUTPUT) \
		$(SCRIPTDIR)/speller-testres.pl
	$(SCRIPTDIR)/speller-testres.pl \
		--$(TESTTOOL) \
		--input=$< \
		--output=$(SPELLEROUTPUT) \
		--document=$(<F) \
		--date=$(DATE)-$(TESTTIME) \
		--version="$(LEXICONVERSION)" \
		--toolversion="`cat $(SPELLERVERSION)`" \
		--memoryuse="`cat spellermemusage.txt`" \
		--timeuse="`cat spellertimeusage.txt`" \
		--xml=$@

$(FORRESTTESTRESULT): $(SPELLERTESTRESULT)
	$(MKDIR_P) $(@D)
	cp $< $@
	if [ -f $(@D)/latest-$< ] ; then \
		cd $(@D) && mv latest-$< previous-$< ; \
	fi
	cd $(@D) && $(LN_S) $(@F) latest-$<

# Clean generated files:
clean-local:
	-rm -f *.txt *.xml
